Ferran Vegas - arquitecto soluciones
Curso administrador Azure.

Curso de azure: https://virtualizadesdezero.com/

7/2/2022

Azure Active directory -> Autentica kerberos y autorizar.
Atenticar Recursos locales y los modernos ()

solo tengo una identidad, pero realmente tienes dos (active directory + azure AD)

service account -> es una identidad apartir de 2012.

Azure tenant -> es un AD de Azure - intancia de Azure (global admin -> permisos totales en el tenant, gestiona las usuario, etc.. no tiene coste y cambia a nivel de licencias que aplicas)
Azure subscription -> para crear recursos es la suscription. entorno de facturación, permite crear recursos

intune (endpoint manager) -> quieres gestionar todos mis dispositivos.
automatizacion y logs.
logs analitics servicio "pay as you go"


azure AD -> solucion identidad. diseñada para comunicaciones http y https.
Queries usados Rest API.

No hay gerarquica. es una estructura plana.

4 sabores de Active directory.
free, microsoft 365 apps, P1 , P2 (Premium)

seguridad moderna -> 
office 365 -> proteger informacion sin tener que meterte en los equipos.
con la P2 govierno identidades.

MIM -> Microsoft identidad Manager para la gestion reset usuarios, etc..

active directory on-prem y se sincronice en azure AD mediante connect.

asignar localización de usuarios.
ad connect (identity manager) provisionar identidades en la nube. software que te descargas.

Los grupos de seguridad no se pueden restaurar.

neuronaedgar@outlook.com
edg0000$8

https://github.com/MicrosoftLearning/AZ-104-MicrosoftAzureAdministrator.git

AZ-104-MicrosoftAzureAdministrator/Instructions/Labs/LAB_01-Manage_Azure_AD_Identities.md

14/02/2022
Gobierno
pay as you go -> controlar subscription.
residencia de la información por regiones.
Coste regiones -> 
Calidad de las comunicaciones.
Flexibilidad y capacidad de escalado.
Las IP estáticas son reservas de DHCP.
Las soluciones PaaS vas vinculadas a la region y dan un SLA.
SLA de Azure 99,95 una instancia.
Han sacado ahora balanceadores globales.
Cosmosdb bases de datos nosql.
Todas las regiones tienen una region pareada -> replicar la informacio en otro datacenter.
Lo que almaceno en azure es durable -> si hubiera un desastre habria una region replicada.

Generar una subscription para deplegar un servicio (intune, etc..)
- Enterprise agreement, se renegocia cada año. (Si dispones más de 25 servidores)
- Resellers -> CSP una empresa hacen de intermediario.
- Partner -> subscripcion o generan una solución tipo SaaS, PaaS, yo solo lo uso.
- Personal free account -> cuenta gratuita de 30 dias.

Tienes que convertir la subscrippcion a "pay as you go" para que te cobren

- free appservices (1h)
- Balanceadores en basics.

No todas las subscripciones tienen cost analisis.
Cost Management:
- cost analysis
- Cost alerts
- Budgets
- Advisor Recommendations.

Tag:
recursos classic -> estructura formato similar a AWS.
Resource Manager -> resource group 
etiqueta para costes. facturacion internas.
facturacion por grupo de recursos.
Tags para automatizar.
Autoshutdown ->
Automation account -> arrancar las maquinas a una hora concreta.
  
Ahorro costes:
reduccion de costes hay que modernizar la aplicaciones.
ventaja hibrida -> pago de la licencia con software asurance.
Reserva instancia 1 año 41% y 3 años 62%. La licencia se mantienen.

Para reducir los costes te debes transformar en un PaaS.
Politica de inmobilidad es una mala politica.

Management group son conjunto de subscripciones. Organizaciones logicas de susbcripciones.
Azure Policy "directivas" -> 
- politicas que bloquean 
- verificacion de cumplimiento y se ponen. 

initiative "iniciativas" -> conjunto de politicas es una agrupacion y se aplican, asignan a:
- management group
- recursos.
- etc..

permisos y roles -> 

Apartado de compliance

ASR -> replicar la maquina entre regiones. Es caro, es mas barato snapshot y lo mueves y lo atachas.

Es mas facil indicar los recursos que no quieres que se despliegue, pues indicar los que quieres puede  provocar que permites compute machine pero no las networks, etc...


Politica habitual acceso basado en roles.
role: owner - permiso para todo.
"global admin" esta en el tenant, solo para crear usuarios.

contributor -> todo lo del owner pero no puede hacer delagaciones, dar acceso a un recurso.
Reader -> pueden leer todo.

User access administrator -> puede asignar permisos pero no modificar. 
Siempre al menor permiso.

security Principal -> role definition, role asignment.

role en Azure -> objeto maquina no de dentro servidor.

Roles de:
Azure active directory -> usuarios, grupos, licencias, etc.. permisos aplicaciones. Scope es el tenant.
Azure RBAC de azure -> roles a subcripcion, recursos, manage group, etc..

autenticacion y autorizacion lo gestiona azure AD.

Global admin/User access admin solo hay uno y es dueño de la subcripcion.
User access Administrator -> es lo que le falta el contributor.

16/02/2022
herramienta de administracion.
Portal viejo "basic" 
Azure Resource Manager -> ARM capa de gestion. interface para comunicarnos con azure.
Microsoft crea portal nuevo para simplicar la gestión

te permite agrupar los recursos en grupos.
Log analitics -> Origen de logs. (Azure Monitor)
SIEM Azure sentinel -> 
Qradar IBM es top.
Siem debe ser capaz de recoger los logs. Leer de Log analitics y analizarla.

grupo recursos -> no se puede anidar y un recursos no pueden estar en 2 grupos de recursos diferentes.
Se pueden mover recursos de un grupo a otro (casi todos) pero no renombrar una vez creado.
Pueden tener recursos de multiples regiones.

plantilla ARM -> tener infraestructura como codigo.

Todos los recursos tienen un proveedor "Resource Provider"
Resource Manager Lock -> delete (no te permite borrar) y read-only (ni borrar ni cambiar configuracion)

 https://exam-files.com/Microsoft/AZ-104/
 
Resource Limits "quota"
Problema para soluciones para escalar -> "scale set" 
 
new-azresourceGroup -Name ppillo -location northeurope -> te crea un grupo de recursos.

Cloud shell necesita de "storage account"

get-azcontext
get-azsubscrition
set-azcontext -suscription "susciprcion" # para cambiar de suscription

Referencias comandos CLI
https://docs.microsoft.com/es-es/cli/azure/
Referencias comandos Powershell
https://docs.microsoft.com/es-es/powershell/azure/get-started-azureps?view=azps-7.2.0

Para instalar el modulo de powershell de Azure en tu equipo.
PS c:\xxxx > install-module AZ 
PS c:\xxxx > import-module az
PS c:\xxxx > connect-azaccount -TenantID "d527217bdegd7d17"
PS c:\xxxx > get-azcontext 


CBT Nuggets -> repositorio para dependencias.
Visual Studio Code

Para instalar el modulo de CLI de Azure en tu equipo
https://docs.microsoft.com/es-es/cli/azure/install-azure-cli-windows?tabs=azure-cli







 